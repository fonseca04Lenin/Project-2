<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stock Watchlist Pro - The Future of Market Intelligence</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="/favicon.svg">
    <link rel="icon" type="image/svg+xml" href="/favicon-16x16.svg" sizes="16x16">
    <link rel="apple-touch-icon" href="/favicon.svg">
    <meta name="theme-color" content="#22c55e">
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Styles -->
    <link rel="stylesheet" href="static/css/marketpulse-landing.css?v=black-bg-fix">
    <link rel="stylesheet" href="static/css/style.css?v=2.1-seamless-auth">
    <link rel="stylesheet" href="static/css/react-ai-chat.css?v=1.0">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <!-- Landing page styles -->
    <style>
        /* Ensure landing page looks clean */
        body {
            margin: 0;
            padding: 0;
            background-color: #000000 !important;
            color: #ffffff !important;
        }
        
        #marketpulse-root {
            min-height: 100vh;
            width: 100%;
        }
        
        /* Ensure loading screen shows initially */
        #loading-screen {
            background-color: #000000;
        }
        
        /* Ensure app container is visible */
        #app {
            width: 100%;
            min-height: 100vh;
        }
    </style>
    
    <!-- Firebase SDK v9 with Compat Mode (Most reliable) -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="firebase-config.js"></script>
</head>
<body>
    <div id="app" style="min-height: 100vh; background: #000;">
        <!-- React Landing Page Root -->
        <div id="marketpulse-root" style="min-height: 100vh; display: block !important;"></div>
        
        <!-- Loading Screen - hidden by default, shown during auth check -->
        <div id="loading-screen" class="loading-screen" style="display: none;">
            <div class="loading-container">
                <div class="loading-spinner">
                    <div class="spinner-ring"></div>
                </div>
                <div class="loading-text">
                    <h2>Stock Watchlist Pro</h2>
                    <p>Loading your experience...</p>
                </div>
            </div>
        </div>

        <!-- Notification Container -->
        <div id="notificationContainer" class="notification-container"></div>
        
        <!-- Stock Details Modal -->
        <div id="stockDetailsModal" class="stock-details-modal" style="display: none;">
          <div class="stock-details-content">
            <button class="close-details-btn close-details-btn-right" id="closeDetailsBtn" title="Close" onclick="closeStockDetailsModal()">
              <i class="fas fa-times"></i>
            </button>
            <div class="stock-details-header">
              <h2 id="detailsCompanyName">Company Name</h2>
              <span id="detailsSymbol" class="details-symbol"></span>
            </div>
            <div class="stock-details-meta">
              <div><strong data-icon="ceo">CEO:</strong> <span id="detailsCEO">-</span></div>
              <div><strong data-icon="desc">Description:</strong> <span id="detailsDescription">-</span></div>
              <div><strong data-icon="price">Price:</strong> $<span id="detailsPrice">-</span></div>
              <div><strong data-icon="marketcap">Market Cap:</strong> <span id="detailsMarketCap">-</span></div>
              <div><strong data-icon="pe">P/E Ratio:</strong> <span id="detailsPERatio">-</span></div>
              <div><strong data-icon="dividend">Dividend Yield:</strong> <span id="detailsDividendYield">-</span></div>
              <div><strong data-icon="website">Website:</strong> <a id="detailsWebsite" href="#" target="_blank" rel="noopener noreferrer">-</a></div>
              <div><strong data-icon="hq">Headquarters:</strong> <span id="detailsHeadquarters">-</span></div>
            </div>
            <!-- Watchlist-specific information -->
            <div id="watchlistDetails" class="watchlist-details" style="display: none;">
              <h3 class="watchlist-details-title">Watchlist Information</h3>
              <div class="watchlist-details-meta">
                <div><strong data-icon="calendar">Date Added:</strong> <span id="detailsDateAdded">-</span></div>
                <div><strong data-icon="dollar">Original Price:</strong> $<span id="detailsOriginalPrice">-</span></div>
                <div><strong data-icon="trend">Price Change:</strong> <span id="detailsPriceChange">-</span></div>
                <div><strong data-icon="percent">Percentage Change:</strong> <span id="detailsPercentageChange">-</span></div>
                <div><strong data-icon="category">Category:</strong> <span id="detailsCategory">-</span></div>
              </div>
              <!-- React Notes Editor Component -->
              <div id="watchlistNotesEditor"></div>
            </div>
            <div id="detailsChartContainer" class="chart-container" style="min-height: 300px;"></div>
            <div id="detailsNewsContainer" class="stock-details-news"></div>
            <button id="addToWatchlistBtn" class="add-to-watchlist-btn" style="display: none;">Add to Watchlist</button>
          </div>
        </div>
        <!-- End Stock Details Modal -->
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
    <script src="config.js?v=2.2"></script>
    
    <!-- React Integration -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- NEW DASHBOARD UI - Load it FIRST so it's available for showMainContent -->
    <link rel="stylesheet" href="static/css/dashboard-redesign.css?v=20250122-new-ui">
    <div id="dashboard-redesign-root" style="display: none; position: relative; z-index: 1000;"></div>
    <script type="text/babel" src="src/react-dashboard-redesign.js"></script>
    
    <!-- Pre-override showMainContent BEFORE app.js and make it work with DashboardRedesign -->
    <script>
        // Wait for DashboardRedesign to be available
        const waitForDashboard = setInterval(() => {
            if (window.DashboardRedesign) {
                clearInterval(waitForDashboard);
                setupShowMainContent();
            }
        }, 100);
        
        function setupShowMainContent() {
            // Override showMainContent before app.js loads
            window.showMainContent = function(user) {
                console.log('üéØ Overridden showMainContent called', user);
                
                // Hide loading screen immediately
                const loadingScreen = document.getElementById('loading-screen');
                if (loadingScreen) {
                    loadingScreen.style.display = 'none';
                }
                
                // Hide landing page
                const marketpulseRoot = document.getElementById('marketpulse-root');
                if (marketpulseRoot) {
                    marketpulseRoot.style.display = 'none';
                }
                
                // Show new dashboard
                const redesignRoot = document.getElementById('dashboard-redesign-root');
                if (redesignRoot && !redesignRoot.hasAttribute('rendered')) {
                    const root = ReactDOM.createRoot(redesignRoot);
                    if (window.DashboardRedesign) {
                        root.render(React.createElement(window.DashboardRedesign));
                        redesignRoot.setAttribute('rendered', 'true');
                        console.log('‚úÖ New dashboard rendered!');
                    } else {
                        console.error('‚ùå DashboardRedesign not available');
                    }
                }
                if (redesignRoot) {
                    redesignRoot.style.display = 'block';
                    redesignRoot.style.position = 'relative';
                    redesignRoot.style.zIndex = '1000';
                }
            };
            
            // Also listen for the userAuthenticated event from React landing page
            window.addEventListener('userAuthenticated', function(event) {
                console.log('üì° Received userAuthenticated event');
                if (event.detail && event.detail.user) {
                    // Call showMainContent with the user data
                    setTimeout(() => {
                        window.showMainContent({ 
                            email: event.detail.user.email, 
                            id: event.detail.user.uid,
                            name: event.detail.user.displayName || event.detail.user.email.split('@')[0]
                        });
                    }, 100);
                }
            });
        }
    </script>
    
    <script src="static/js/app.js?v=20250122-SEAMLESS-AUTH&t=1761181421312"></script>
    <script type="text/babel" src="src/react-landing-page.js"></script>
    <script type="text/babel" src="src/react-watchlist.js?v=20250122-SEARCH-BAR-FIX"></script>
    <script type="text/babel" src="src/react-ai-chat.js?v=1.0"></script>
    <script type="text/babel" src="src/react-header.js?v=1.0"></script>
    <script type="text/babel" src="src/react-chart.js?v=1.0"></script>
    <script type="text/babel" src="src/react-watchlist-notes.js?v=1.0"></script>
    <script type="text/babel" src="src/react-stock-details-modal.js?v=1.0"></script>
    <script src="src/vanilla-search-bar.js?v=20250122-SEARCH-BAR-FIX"></script>
    
    <!-- Duplicate showNewDashboard function for Firebase auth state changes -->
    <script type="text/babel">
        // Make showNewDashboard available globally
        window.showNewDashboard = function() {
            console.log('üîµ showNewDashboard called');
            
            // Hide landing page
            const marketpulseRoot = document.getElementById('marketpulse-root');
            if (marketpulseRoot) {
                marketpulseRoot.style.display = 'none';
            }
            
            // Hide loading screen
            const loadingScreen = document.getElementById('loading-screen');
            if (loadingScreen) {
                loadingScreen.style.display = 'none';
            }
            
            // Show new dashboard
            const redesignRoot = document.getElementById('dashboard-redesign-root');
            if (redesignRoot && !redesignRoot.hasAttribute('rendered')) {
                const root = ReactDOM.createRoot(redesignRoot);
                if (window.DashboardRedesign) {
                    root.render(React.createElement(window.DashboardRedesign));
                    redesignRoot.setAttribute('rendered', 'true');
                }
            }
            if (redesignRoot) {
                redesignRoot.style.display = 'block';
                redesignRoot.style.position = 'relative';
                redesignRoot.style.zIndex = '1000';
            }
        };
        
        window.hideNewDashboard = function() {
            const redesignRoot = document.getElementById('dashboard-redesign-root');
            if (redesignRoot) {
                redesignRoot.style.display = 'none';
            }
        };
        
        // Listen for Firebase auth state changes (fallback in case showMainContent wasn't called)
        setTimeout(() => {
            if (typeof firebase !== 'undefined' && firebase.auth) {
                firebase.auth().onAuthStateChanged((user) => {
                    if (user) {
                        console.log('üë§ Firebase auth state changed - user logged in');
                        window.showNewDashboard();
                    } else {
                        console.log('‚ùå Firebase auth state changed - no user');
                        window.hideNewDashboard();
                    }
                });
            }
        }, 500);
    </script>
</body>
</html> 